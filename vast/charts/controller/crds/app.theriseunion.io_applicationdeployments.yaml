---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: applicationdeployments.app.theriseunion.io
spec:
  group: app.theriseunion.io
  names:
    categories:
    - app
    kind: ApplicationDeployment
    listKind: ApplicationDeploymentList
    plural: applicationdeployments
    shortNames:
    - appd
    singular: applicationdeployment
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.application
      name: Application
      type: string
    - jsonPath: .status.applicationVersion
      name: Version
      type: string
    - jsonPath: .status.readyStatus
      name: Ready
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          ApplicationDeployment is the Schema for the applicationdeployments API
          ApplicationDeployment 定义应用部署实例，支持部署到多个拓扑（节点组/节点）
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              ApplicationDeploymentSpec defines the desired state of ApplicationDeployment
              ApplicationDeployment 表示应用部署实例，支持部署到多个节点组/节点
            properties:
              application:
                description: Application 应用名称
                type: string
              topologies:
                description: |-
                  Topologies 部署拓扑列表，每个拓扑会创建对应的工作负载
                  如果为空，则使用默认调度策略
                items:
                  description: DeploymentTopology 定义部署拓扑（节点组或节点选择器）
                  properties:
                    nodeGroup:
                      description: NodeGroup 节点组名称
                      type: string
                    nodeName:
                      description: NodeName 节点名称（为空表示由调度器决定）
                      type: string
                  type: object
                type: array
              version:
                description: |-
                  Version 应用版本号（语义化版本，如 "1.0.0"）
                  用户友好的版本标识，支持特殊值 "latest" 表示使用最新版本
                  API Handler 会根据 Application + Version 自动查找对应的 ApplicationVersion 资源
                type: string
            required:
            - application
            - version
            type: object
          status:
            description: ApplicationDeploymentStatus defines the observed state of
              ApplicationDeployment
            properties:
              application:
                description: Application 当前部署的应用名称
                type: string
              applicationVersion:
                description: ApplicationVersion 当前部署的应用版本号（如果 spec 使用 latest，这里记录实际解析的版本号）
                type: string
              applicationVersionName:
                description: ApplicationVersionName 实际使用的 ApplicationVersion 资源名称（如
                  nginx-v1.0.0）
                type: string
              conditions:
                description: Conditions represent the latest available observations
                  of deployment state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              history:
                description: History 版本变更历史（最多保留 10 条）
                items:
                  description: DeploymentHistory 版本变更历史
                  properties:
                    application:
                      description: Application 应用名称
                      type: string
                    fromVersion:
                      description: FromVersion 变更前的版本号（升级/回滚时记录）
                      type: string
                    message:
                      description: Message 变更说明
                      type: string
                    operator:
                      description: Operator 操作人
                      type: string
                    readyReplicas:
                      description: ReadyReplicas 变更时的就绪副本数
                      format: int32
                      type: integer
                    reason:
                      description: Reason 变更原因（Initial, Upgrade, Rollback）
                      type: string
                    timestamp:
                      description: Timestamp 变更时间
                      format: date-time
                      type: string
                    toVersion:
                      description: ToVersion 变更后的版本号
                      type: string
                    topologies:
                      description: Topologies 变更时的拓扑快照
                      items:
                        description: DeploymentTopology 定义部署拓扑（节点组或节点选择器）
                        properties:
                          nodeGroup:
                            description: NodeGroup 节点组名称
                            type: string
                          nodeName:
                            description: NodeName 节点名称（为空表示由调度器决定）
                            type: string
                        type: object
                      type: array
                    totalReplicas:
                      description: TotalReplicas 变更时的总副本数
                      format: int32
                      type: integer
                    workloadCount:
                      description: WorkloadCount 变更时的工作负载数量
                      format: int32
                      type: integer
                  required:
                  - application
                  - reason
                  - timestamp
                  - toVersion
                  type: object
                type: array
              message:
                description: Message 状态消息
                type: string
              phase:
                description: Phase represents the current phase of deployment lifecycle
                type: string
              readyReplicas:
                description: ReadyReplicas 所有拓扑的就绪副本数之和
                format: int32
                type: integer
              readyStatus:
                description: ReadyStatus 就绪状态字符串（格式：readyReplicas/totalReplicas，用于
                  kubectl get 显示）
                type: string
              readyWorkloadCount:
                description: ReadyWorkloadCount 就绪的工作负载数量
                format: int32
                type: integer
              topologyStatuses:
                description: TopologyStatuses 各个拓扑的部署状态
                items:
                  description: TopologyStatus 单个拓扑的部署状态
                  properties:
                    message:
                      description: Message 状态消息
                      type: string
                    nodes:
                      description: Nodes Pod 实际运行的节点列表
                      items:
                        type: string
                      type: array
                    phase:
                      description: Phase 当前状态
                      type: string
                    readyReplicas:
                      description: ReadyReplicas 就绪副本数
                      format: int32
                      type: integer
                    replicas:
                      description: Replicas 期望副本数
                      format: int32
                      type: integer
                    topology:
                      description: Topology 拓扑定义（复制自 Spec）
                      properties:
                        nodeGroup:
                          description: NodeGroup 节点组名称
                          type: string
                        nodeName:
                          description: NodeName 节点名称（为空表示由调度器决定）
                          type: string
                      type: object
                    topologyIndex:
                      description: Topology 拓扑定义（复制自 Spec）
                      format: int32
                      type: integer
                    workloadName:
                      description: WorkloadName 创建的工作负载名称（Deployment/StatefulSet等）
                      type: string
                  required:
                  - topology
                  - topologyIndex
                  type: object
                type: array
              totalReplicas:
                description: TotalReplicas 所有拓扑的副本数之和
                format: int32
                type: integer
              workloadCount:
                description: WorkloadCount 总工作负载数量（等于 len(topologyStatuses)）
                format: int32
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
