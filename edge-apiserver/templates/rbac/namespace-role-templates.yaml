{{- /*
  Namespace Default Role Templates
  These are built-in IAMRoles that serve as templates for namespace-scoped roles.

  Naming Convention (auto-generated by controller):
    Format: namespace-<name-prefix>-<name-hash>-<role-type>
    - scope: "namespace" (full scope name)
    - name-prefix: first 15 chars of namespace name
    - name-hash: first 8 chars of SHA256(name) hex
    - role-type: admin/operator/viewer
    Max length: 43 chars (namespace-{15}-{8}-operator)

  Examples:
    Namespace "backend" → namespace-backend-5d3e7a9c-admin
    Namespace "microservices-api-gateway-production"
      → namespace-microservices-a-c8f2b4d1-admin

  Note: The full "namespace-" prefix prevents naming conflicts with workspace/nodegroup roles.
        The hash suffix ensures uniqueness even when name-prefix is identical.
*/ -}}

---
apiVersion: iam.theriseunion.io/v1alpha1
kind: IAMRole
metadata:
  name: namespace-admin
  labels:
    iam.theriseunion.io/builtin: "true"
    iam.theriseunion.io/scope: "namespace"
    iam.theriseunion.io/role-type: "admin"
  annotations:
    iam.theriseunion.io/creator: "system"
    theriseunion.io/alias-name: "namespace-admin"
    iam.theriseunion.io/display-name-en: "Project Administrator"
    iam.theriseunion.io/display-name-zh: "项目管理员"
    iam.theriseunion.io/description-en: "Manage all resources in the project"
    iam.theriseunion.io/description-zh: "管理项目中的所有资源"
spec:
  # UI权限定义：项目管理员拥有完全控制权限
  uiPermissions:
    - "namespace/role.view"        # 查看角色
    - "namespace/role.create"      # 创建角色
    - "namespace/role.edit"        # 编辑角色
    - "namespace/role.delete"      # 删除角色
    - "namespace/member.view"      # 查看成员
    - "namespace/member.manage"    # 管理成员
    - "namespace/workload.view"    # 查看工作负载
    - "namespace/workload.manage"  # 管理工作负载
    - "namespace/config.view"      # 查看配置
    - "namespace/config.manage"    # 管理配置
    - "namespace/resource.view"    # 查看资源
    - "namespace/resource.manage"  # 管理资源
  aggregationRoleTemplates:
    roleSelector:
      matchLabels:
        iam.theriseunion.io/aggregate-to-namespace-admin: "true"

---
apiVersion: iam.theriseunion.io/v1alpha1
kind: IAMRole
metadata:
  name: namespace-operator
  labels:
    iam.theriseunion.io/builtin: "true"
    iam.theriseunion.io/scope: "namespace"
    iam.theriseunion.io/role-type: "operator"
  annotations:
    iam.theriseunion.io/creator: "system"
    theriseunion.io/alias-name: "namespace-operator"
    iam.theriseunion.io/display-name-en: "Project Operator"
    iam.theriseunion.io/display-name-zh: "项目操作员"
    iam.theriseunion.io/description-en: "Manage resources except users and roles"
    iam.theriseunion.io/description-zh: "管理项目中除用户和角色之外的资源"
spec:
  # UI权限定义：项目运维人员可以管理工作负载和配置，但不能管理成员和角色
  uiPermissions:
    - "namespace/role.view"        # 查看角色（只读）
    - "namespace/member.view"      # 查看成员（只读）
    - "namespace/workload.view"    # 查看工作负载
    - "namespace/workload.manage"  # 管理工作负载
    - "namespace/config.view"      # 查看配置
    - "namespace/config.manage"    # 管理配置
    - "namespace/resource.view"    # 查看资源
    - "namespace/resource.manage"  # 管理资源
  aggregationRoleTemplates:
    roleSelector:
      matchLabels:
        iam.theriseunion.io/aggregate-to-namespace-operator: "true"

---
apiVersion: iam.theriseunion.io/v1alpha1
kind: IAMRole
metadata:
  name: namespace-viewer
  labels:
    iam.theriseunion.io/builtin: "true"
    iam.theriseunion.io/scope: "namespace"
    iam.theriseunion.io/role-type: "viewer"
  annotations:
    iam.theriseunion.io/creator: "system"
    theriseunion.io/alias-name: "namespace-viewer"
    iam.theriseunion.io/display-name-en: "Project Viewer"
    iam.theriseunion.io/display-name-zh: "项目查看者"
    iam.theriseunion.io/description-en: "View all resources in the project"
    iam.theriseunion.io/description-zh: "查看项目中的所有资源"
spec:
  # UI权限定义：项目观察者只能查看，没有任何修改权限
  uiPermissions:
    - "namespace/role.view"        # 查看角色
    - "namespace/member.view"      # 查看成员
    - "namespace/workload.view"    # 查看工作负载
    - "namespace/config.view"      # 查看配置
    - "namespace/resource.view"    # 查看资源
  aggregationRoleTemplates:
    roleSelector:
      matchLabels:
        iam.theriseunion.io/aggregate-to-namespace-viewer: "true"
