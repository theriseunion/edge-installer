# Traefik Proxy Configuration
# 
# This chart deploys Traefik v3.x as an ingress controller with support for
# both HTTP and TCP routing (including KubeEdge CloudCore ports).

# Namespace configuration
namespace: traefik

# Global configuration
global:
  imageRegistry: "quanzhenglong.com"
  imagePullSecrets: []

# Traefik configuration
traefik:
  replicaCount: 1

  image:
    registry: ""
    repository: edge/traefik
    tag: "v3.2"
    pullPolicy: IfNotPresent
    pullSecrets: []

  # Resources configuration
  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # Node selector and affinity
  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Pod annotations
  podAnnotations: {}

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 65532
    fsGroup: 65532

  # Container security context
  containerSecurityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
      add:
        - NET_BIND_SERVICE

# Entry points configuration
entryPoints:
  # HTTP entry point - port 80
  web:
    enabled: true
    port: 80
    nodePort: 30080
    protocol: TCP

  # HTTPS entry point - port 443
  websecure:
    enabled: true
    port: 443
    nodePort: 30443
    protocol: TCP

  # WebSocket entry point - port 8080
  websocket:
    enabled: true
    port: 8080
    nodePort: 30808
    protocol: TCP

  # KubeEdge CloudCore WebSocket
  ccWs:
    enabled: true
    port: 10000
    nodePort: 30000
    protocol: TCP

  # KubeEdge CloudCore HTTPS
  ccHttps:
    enabled: true
    port: 10002
    nodePort: 30002
    protocol: TCP

  # KubeEdge CloudCore Stream
  ccStream:
    enabled: true
    port: 10003
    nodePort: 30003
    protocol: TCP

  # KubeEdge CloudCore Tunnel
  ccTunnel:
    enabled: true
    port: 10004
    nodePort: 30004
    protocol: TCP

  # Prometheus Remote Write - port 9090 exposed as NodePort 30990
  prometheusRemoteWrite:
    enabled: true
    port: 9090
    nodePort: 30990
    protocol: TCP

# Providers configuration
providers:
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true
    allowExternalNameServices: true

  file:
    enabled: true
    directory: /etc/traefik/dynamic
    watch: true

# Log configuration
log:
  level: INFO
  format: json

# Access log configuration
accessLog:
  enabled: true
  format: json
  bufferingSize: 100

# Ping / health check configuration
ping:
  enabled: true
  entryPoint: web

# TLS configuration
tls:
  enabled: true
  # Certificate configuration
  # If autogenerate is true, Helm will generate self-signed certificates
  autogenerate: true
  # Custom certificate (only used if autogenerate is false)
  certificate:
    crt: ""
    key: ""
  # TLS options
  options:
    minVersion: VersionTLS12
    sniStrict: false

# Service configuration
service:
  type: NodePort
  annotations: {}

# ServiceAccount configuration
serviceAccount:
  create: true
  name: traefik
  annotations: {}

# RBAC configuration
rbac:
  create: true

# CRD installation
crds:
  install: true

# Traefik CRD resources to watch
crdResources:
  - ingressroutes
  - ingressroutetcps
  - ingressrouteudps
  - middlewares
  - middlewaretcps
  - tlsoptions
  - tlsstores
  - traefikservices
  - serverstransports
  - serverstransporttcps
