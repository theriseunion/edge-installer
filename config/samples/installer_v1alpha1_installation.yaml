apiVersion: installer.theriseunion.io/v1alpha1
kind: Installation
metadata:
  name: edge-platform
  namespace: edge-system
spec:
  # Edge Platform 版本
  version: "v1.0.0"

  # 组件配置
  components:
    # Edge Controller 配置
    controller:
      enabled: true
      replicas: 1
      enableInit: true  # 启用自动初始化
      image:
        repository: quanzhenglong.com/edge/edge-controller
        tag: main
        pullPolicy: Always
      resources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: 500m
          memory: 512Mi
      # 额外的 Helm values
      values:
        metricsAddr: ":8082"

    # Edge API Server 配置
    apiserver:
      enabled: true
      replicas: 2
      image:
        repository: quanzhenglong.com/edge/edge-apiserver
        tag: main
        pullPolicy: Always
      resources:
        limits:
          cpu: "2"
          memory: 2Gi
        requests:
          cpu: "1"
          memory: 1Gi
      values:
        port: 8080

    # Edge Console 配置
    console:
      enabled: true
      replicas: 1
      image:
        repository: quanzhenglong.com/edge/edge-console
        tag: main
        pullPolicy: Always
      resources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: 500m
          memory: 512Mi
      # Ingress 配置
      ingress:
        enabled: true
        host: console.edge.example.com
        tls: true
      values:
        apiServer: "http://edge-apiserver:8080"

    # 监控配置 (可选)
    monitoring:
      enabled: true
      prometheus:
        enabled: true
        retention: "15d"
      grafana:
        enabled: true

  # 集群初始化配置
  initialization:
    enabled: true
    clusterName: "host"
    systemWorkspace: "system-workspace"
    systemNamespaces:
      - "kube-system"
      - "kube-public"
      - "kube-node-lease"
      - "edge-system"
      - "observability-system"
