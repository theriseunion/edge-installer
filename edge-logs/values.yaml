# Default values for edge-logs.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  imageRegistry: "quanzhenglong.com/edge"
  imagePullSecrets: []
  storageClass: ""

# Namespace settings
namespaceOverride: "logging-system"

# APIServer configuration
apiserver:
  enabled: true
  replicaCount: 1

  image:
    registry: ""  # 使用global.imageRegistry
    repository: logs-apiserver
    tag: "main-c25d940"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 8080

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  livenessProbe:
    enabled: true
    path: /api/v1alpha1/health
    initialDelaySeconds: 30
    periodSeconds: 30

  readinessProbe:
    enabled: true
    path: /api/v1alpha1/health
    initialDelaySeconds: 10
    periodSeconds: 10

  config:
    clickhouse:
      host: ""  # Will be auto-generated
      port: 9000
      database: "edge_logs"
      username: "default"
      password: ""
      tls: false

    kubernetes:
      in_cluster: true
      config_path: ""

    logging:
      level: "info"
      format: "text"
      enable_json: true

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 1

  image:
    registry: ""  # 使用global.imageRegistry
    repository: logs-frontend
    tag: "main-c25d940"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 80

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# ClickHouse configuration
clickhouse:
  enabled: true

  image:
    registry: ""  # 使用global.imageRegistry
    repository: clickhouse-server
    tag: "24.3"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    httpPort: 8123
    tcpPort: 9000

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  persistence:
    enabled: true
    storageClass: ""
    size: 10Gi

  config:
    # ClickHouse configuration
    retention_days: 30

# OTEL Collector configuration
otelCollector:
  enabled: true
  replicaCount: 1

  image:
    registry: ""  # 使用global.imageRegistry
    repository: opentelemetry-collector-contrib
    tag: "0.98.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"

# iLogtail configuration
ilogtail:
  enabled: true

  image:
    registry: ""  # 使用global.imageRegistry
    repository: ilogtail
    tag: "2.0.4"
    pullPolicy: Always

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: edge-logs.local
      paths:
        - path: /
          pathType: Prefix
          service: frontend
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

# ServiceAccount
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# RBAC
rbac:
  create: true

# Pod Security Context
podSecurityContext:
  fsGroup: 1000

# Security Context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Environment-specific overrides
environments:
  dev:
    apiserver:
      image:
        tag: "develop"
    frontend:
      image:
        tag: "develop"
    clickhouse:
      persistence:
        size: 5Gi

  staging:
    apiserver:
      image:
        tag: "main"
      replicaCount: 1
    frontend:
      image:
        tag: "main"
    clickhouse:
      persistence:
        size: 20Gi

  prod:
    apiserver:
      image:
        tag: "latest"
      replicaCount: 2
      resources:
        requests:
          memory: "256Mi"
          cpu: "200m"
        limits:
          memory: "1Gi"
          cpu: "1000m"
    frontend:
      image:
        tag: "latest"
      replicaCount: 2
    clickhouse:
      persistence:
        size: 100Gi
      resources:
        requests:
          memory: "1Gi"
          cpu: "500m"
        limits:
          memory: "4Gi"
          cpu: "2000m"