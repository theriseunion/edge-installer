# Edge Platform Unified Configuration
# Supports single-command installation of all components

# Global configuration
global:
  # Installation mode: all, host, member, none
  #   - all: install all components (for standalone clusters)
  #   - host: install apiserver, controller, console, monitoring (for host clusters)
  #   - member: install apiserver, controller, monitoring (for member clusters)
  #   - none: only install controller infrastructure, no components
  mode: "all"

  # Namespace for all components
  namespace: "edge-system"

  # Image registry
  imageRegistry: "quanzhenglong.com"

# Override the full name to remove edge- prefix
fullnameOverride: "controller"

# Controller configuration
controller:
  enabled: true
  replicaCount: 1

  image:
    repository: edge/controller
    tag: "main"
    pullPolicy: IfNotPresent

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # ServiceAccount configuration
  serviceAccount:
    create: true
    automount: true
    name: ""

  # Security Context
  securityContext:
    runAsNonRoot: true
    runAsUser: 65532
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL

  # Service configuration
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080

  # Chart repository configuration
  chartRepository:
    # URL will be auto-set to ChartMuseum service
    url: ""

  # Log level (debug, info, warn, error)
  logLevel: info

  # Metrics port
  metricsPort: 8080

  # Health check port
  healthPort: 8081

# Node selector - Schedule on control plane nodes (Kubernetes 1.20+)
nodeSelector:
  node-role.kubernetes.io/control-plane: ""
  # For older Kubernetes versions (< 1.20), use:
  # node-role.kubernetes.io/master: ""
  #
  # To schedule on any node, set to empty:
  # nodeSelector: {}

# ChartMuseum configuration
chartmuseum:
  enabled: true

  # Fixed service name for chartmuseum
  # This ensures Components can reliably access it at chartmuseum.{namespace}.svc
  fullnameOverride: "chartmuseum"

  image:
    repository: edge/edge-museum
    tag: "latest"
    pullPolicy: IfNotPresent

  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

  service:
    type: ClusterIP
    port: 8080

  env:
    # Chart storage settings
    STORAGE: "local"
    STORAGE_LOCAL_ROOTDIR: "/charts"

    # API settings
    DISABLE_API: false
    ALLOW_OVERWRITE: true

    # Chart upload settings
    CONTEXT_PATH: "/"

# Component auto-installation configuration
autoInstall:
  # NOTE: Controller is NOT installed via Component CR in host cluster because
  # it's already deployed as part of this Helm chart. However, the controller
  # Component CR configuration is used when installing controller to member clusters.

  # Controller component configuration (used for member cluster installation)
  controller:
    version: "0.1.0"  # Chart version for member cluster installation

  # APIServer component
  apiserver:
    enabled: true
    version: "0.1.0"
    values:
      replicaCount: 1
      service:
        type: ClusterIP
        port: 8080

  # Console component (only for host/all modes)
  console:
    enabled: false  # Will be set based on global.mode
    version: "0.1.0"
    values:
      replicaCount: 1
      service:
        type: ClusterIP
        port: 3000
      env:
        - name: NEXT_PUBLIC_API_BASE_URL
          value: "http://apiserver:8080"

  # Monitoring component
  monitoring:
    enabled: true
    version: "0.1.0"
    values:
      namespace: "observability-system"
      prometheus:
        enabled: true
      grafana:
        enabled: true
      alertManager:
        enabled: true

  # VAST component
  vast:
    enabled: true # Set to true to enable VAST platform installation
    version: "0.1.0"
    namespace: "rise-vast-system" # Namespace for VAST platform
    values:
      # VAST platform configuration
      # Override default values here if needed
      # Example:
      # controller:
      #   enabled: true
      #   image:
      #     repository: quanzhenglong.com/edge/controller
      #     tag: vast-v0.1.0-11
      # apiserver:
      #   enabled: true
      # hami:
      #   enabled: true

# Hook configuration
hooks:
  # Enable chart packaging/upload hooks
  packageCharts: false

  # Timeout for hook operations
  timeout: 300

  # Delete hook pods after execution
  deletePolicy: before-hook-creation,hook-succeeded