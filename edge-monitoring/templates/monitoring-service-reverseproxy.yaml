{{- if and .Values.global.enabled .Values.monitoringService.enabled }}
apiVersion: iam.theriseunion.io/v1alpha1
kind: ReverseProxy
metadata:
  name: monitoring-proxy
  namespace: {{ .Values.global.namespace }}
  labels:
    app: monitoring-service
    component: monitoring-service
  annotations:
    theriseunion.io/description: Monitoring Service API proxy - proxies metrics and monitoring queries
    openapi-endpoint: /openapi/v2
spec:
  matcher:
    method: '*'
    path: /oapis/monitoring.theriseunion.io/v1alpha1/*
  upstream:
    scheme: http
    host: monitoring-service.{{ .Values.global.namespace }}.svc.cluster.local
    port: 9083
  directives:
    rewrite:
    - from: ^/oapis/monitoring\.theriseunion\.io/v1alpha1/(.*)$
      to: /rest/monitoring/v1/$1
{{- end }}
