# Edge 监控套件配置
# 可选择性安装 Prometheus/Grafana/AlertManager

# 全局配置
global:
  # 是否启用监控套件
  enabled: true
  # 命名空间
  namespace: observability-system
  # 镜像仓库地址（可通过 Helm 参数覆盖）
  # imageRegistry: quanzhenglong.com

# Monitoring Service 配置 - 提供统一的监控数据 API
monitoringService:
  enabled: true
  replicas: 1
  image:
    registry: "quanzhenglong.com"  # 留空则使用 global.imageRegistry
    repository: edge/monitoring-service
    tag: "v1.0.0"
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 9083
    targetPort: 9083

  # 资源限制
  resources:
    requests:
      memory: "100Mi"
      cpu: "50m"
    limits:
      memory: "400Mi"
      cpu: "200m"

# ServiceMonitor 配置 - 自动发现服务
serviceMonitor:
  enabled: false
  # 为 edge 组件创建 ServiceMonitor
  targets:
    - name: edge-apiserver
      service: edge-apiserver
      port: metrics
      path: /metrics
    - name: edge-controller
      service: edge-controller
      port: metrics
      path: /metrics

# Duty Service ReverseProxy 配置
dutyProxy:
  enabled: true
  upstream:
    scheme: http
    host: duty-web.observability-system.svc.cluster.local
    port: 80

# Edge Remote Write 配置 - 接收边缘节点的监控数据
edgeTraefikRemoteWrite:
  # 是否启用边缘数据接收
  enabled: true
  # 通过 Traefik IngressRoute 访问的域名
  remote-hostname: host.rise.io

# edge-prometheus-agent 子 chart 配置
# 边缘节点上的 Prometheus Agent，推送监控数据到云端
edge-prometheus-agent:
  # 云端 Remote Write 地址，格式: http://{clusterName}.rise.io:30990/api/v1/write
  remoteWriteUrl: "http://host.rise.io:30990/api/v1/write"
  # 云端 Gateway IP 地址（必填）
  # 边缘节点 DNS 无法解析自定义域名，需要通过此配置注入 /etc/hosts
  # 配置后自动生成 hostAliases: {clusterName}.{baseDomain} -> gatewayIP
  # 示例: gatewayIP: "188.239.62.17" => host.rise.io -> 188.239.62.17
  gatewayIP: ""

# kube-prometheus-stack 覆盖配置
kube-prometheus-stack:
  prometheus:
    prometheusSpec:
      # 启用 Remote Write Receiver，允许接收边缘节点推送的监控数据
      enableRemoteWriteReceiver: true
      # 为边缘数据添加外部标签，便于区分数据来源
      externalLabels:
        cluster: "cloud"